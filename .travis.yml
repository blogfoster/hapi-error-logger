# dont run on container based infrastructure
sudo: false
dist: trusty
group: travis_latest

language: node_js
node_js:
  - '8'

cache:
  directories:
    - ./node_modules

branches:
  except:
    - /^v[0-9]/ # dont build tags separately as they are build anyway for the push

install:
  - npm prune
  - npm install

before_script:
  - npm run check

script:
  - npm test

deploy:
  provider: npm
  email: npm@blogfoster.com
  api_key:
    secure: "S8Rf8j1Y9FgjPjR2J/rDbzwB055tjuUGn89lhJJ999c+Dpoi+XHqy6Q3W6ULOwQo6gZ7htuZ9wClgqhUPaNeOYiL23jdlIfoGw3zBzXKdSm5VDJOkFVNPRk+ypYJqK1WeLTCrJAc+dRAsSmvv+BDq8IGs512Y1/r+2Do7c/yb6RZv/dX5j6HP5/rhtvKMe49meIWb2NxQoTE48OkwRHvWXSsLSgK1NooCbsYwfrQgSnfig20ysHvyb3qF66rRMkG0xzmTl8GMRRen3eNwr+WdUBp8x4YJy3Zj1k2GEyNn2/tnpJTJm3KQsckWlFV3eJ3lq0hcNyd5+qf2KTeDJztYKpzl+G2XU5v5VJqkDX9sjD6PC1qDeAOpaD+0zoGSzW/o05QzKss6G9COjrSfruJdbv6psxMbShS4igvyjLtyQULx1FwZeauzP0pSiecRPcemR1qh6u8tvAUF+1hXWgvL20Qv5URUWhfRd5HmLZTGNY0DFMKxE0y16vKCZfB7pF21BBc6w9hi6jrxLZ16oKRrS3TyBwOgfgxTAB167UEdz8DRJsib5uiWbRtOrlzJwlbaxPWbDi3GSpO1zW4Ir6/eO79kyiMj0rNvwS3yhLKjBMZmek3/XFLswIC4RuG02VYR7vDElveF2B9ts/SfWRgf9nhPVtjuCU3eLPbz08Ugv4="
  wait-until-deployed: true
  skip_cleanup: true
  on:
    repo: blogfoster/hapi-error-logger
    branch: master
    condition: $(git describe --exact-match HEAD) # only deploy if the commit is referenced by a tag as well
